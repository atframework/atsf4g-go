syntax = "proto3";

option optimize_for = SPEED;
// option optimize_for = LITE_RUNTIME;
// option optimize_for = CODE_SIZE;
// --cpp_out=lite:,--cpp_out=
option cc_enable_arenas = true;

option go_package = "github.com/atframework/atsf4g-go/component-protocol-public/pbdesc/protocol/pbdesc";

import "protocol/common/com.struct.quest.common.proto";

package proy;

message DUserQuestUnlockConditionDetail {
  map<int64, bool> detail = 1;  // key 是unlock_condition value
}

message DUserQuestUnlockConditionTypes {
  map<int32, DUserQuestUnlockConditionDetail> unlock_conditions = 1;  // key 是unlock_condition_type
}

message DUserQuestResetInfo {
  int32 quest_id = 1;
  int64 timepoint = 2; 
}

message DUserQuestData {
  int32 quest_id = 1;
  int64 value = 2;
  EnQuestStatus status = 3;
  map<int64, bool> unique_count = 4;  // 可选字段，非必填，用于部分任务进度的去重
  int64 created_time = 5;             // 领取任务的时间
}

message DQuestProgressForSpecialReport {
  int32 quest_id = 1;
  int64 value = 2;
}

message DUserQuestCompletedData {
  int32 quest_id = 1;
  int64 timepoint = 2;
}

message DUserQuestReceivedData {
  int32 quest_id = 1;
  int64 timepoint = 2;
}

message DUserQuestResetData {
  int32 quest_id = 1;
  int64 value = 2;
  EnQuestStatus old_status = 3;
  EnQuestStatus new_status = 4;
}

message DQuestProgressDataList {
  map<int32, DUserQuestData> quest_progress_list = 1;  // key: quest_id
}

message DUserQuestsData {
  int64 last_event_id = 1;
  string excel_version = 2;  // excel的版本号，这个字段主要用于判断配置是否更新

  map<int32, DQuestProgressDataList> processing_quests = 11;  // 进行中的任务 key: progress_type
  map<int32, DUserQuestCompletedData> completed_quests = 12;  // 已经完成但没有领取奖励的任务 key: quest_id
  map<int32, DUserQuestReceivedData> received_quests = 13;    // 已经完成并且已经领取奖励的任务 key: quest_id
}

message DUserQuestProgressEvent {
  DUserQuestData data = 1;
  EnQuestProgressType type = 2;
}

message DUserQuestForceDeleteData {
  int32 quest_id = 1;
  EnQuestStatus old_status = 2;
  EnQuestProgressType type = 3;  // status为EN_QUEST_STATUS_PROCESSING时才有这个值
}

message DUserQuestEventList {
  repeated DUserQuestEvent events = 1;
}

message DUserQuestEvent {
  int64 event_id = 1;

  oneof event {
    DUserQuestProgressEvent unlock = 11;           // 从未解锁变成进行中
    DUserQuestProgressEvent progress_update = 12;  // 更新进度
    DUserQuestCompletedData complete = 13;         // 完成
    DUserQuestReceivedData received = 14;          // 领取成功
    DUserQuestForceDeleteData force_delete = 15;
  }
}
