syntax = "proto3";

option optimize_for = SPEED;
// option optimize_for = LITE_RUNTIME;
// option optimize_for = CODE_SIZE;
// --cpp_out=lite:,--cpp_out=
option cc_enable_arenas = true;

option go_package = "github.com/atframework/atsf4g-go/component-protocol-public/common/protocol/common";

import "google/protobuf/any.proto";

import "protocol/extension/v3/xresloader.proto";

package proy;

enum EnItemType {
  EN_ITEM_TYPE_INVALID = 0;
  EN_ITEM_TYPE_HIDDEN_VIRTUAL_ITEM = 1 [(org.xresloader.enum_alias) = "hidden_virtual_item"];
  EN_ITEM_TYPE_PACKAGE = 21 [(org.xresloader.enum_alias) = "package"];
  EN_ITEM_TYPE_MONEY = 61 [(org.xresloader.enum_alias) = "money"];
  EN_ITEM_TYPE_PROP = 101 [(org.xresloader.enum_alias) = "prop"];
  EN_ITEM_TYPE_RANDOM_POOL = 230 [(org.xresloader.enum_alias) = "random_pool"];
}

enum EnItemTypeRange {
  option allow_alias = true;

  EN_ITEM_TYPE_RANGE_INVALID = 0;
  EN_ITEM_TYPE_RANGE_VIRTUAL_ITEM_BEGIN = 1000;
  EN_ITEM_TYPE_RANGE_VIRTUAL_ITEM_END = 10000;
  EN_ITEM_TYPE_RANGE_VIRTUAL_ITEM_READ_ONLY_BEGIN = 8000;

  EN_ITEM_TYPE_RANGE_RANDOM_POOL_BEGIN = 590000;
  EN_ITEM_TYPE_RANGE_RANDOM_POOL_END = 600000;
  EN_ITEM_TYPE_RANGE_PROP_BEGIN = 600000;
  EN_ITEM_TYPE_RANGE_PROP_END = 700000;
  EN_ITEM_TYPE_RANGE_QUEST_BEGIN = 8000000;  // 8e6
  EN_ITEM_TYPE_RANGE_QUEST_END = 9000000;    // 9e6
}

enum EnItemMoneyType {
  EN_ITEM_MONEY_TYPE_INVALID = 0;
  EN_ITEM_MONEY_TYPE_COIN = 1001;
  EN_ITEM_MONEY_TYPE_CASH = 1002;
}

enum EnItemVirtualItemType {
  EN_ITEM_VIRTUAL_ITEM_TYPE_INVALID = 0;
  EN_ITEM_VIRTUAL_ITEM_TYPE_USER_EXP = 1101;
  EN_ITEM_VIRTUAL_ITEM_TYPE_READONLY_USER_LEVEL = 8001;
}

enum EnItemFlowReasonMajorType {
  EN_ITEM_FLOW_REASON_MAJOR_INVALID = 0;
  EN_ITEM_FLOW_REASON_MAJOR_USER = 1;          // 玩家基础逻辑
  EN_ITEM_FLOW_REASON_MAJOR_GM = 2;            // GM 命令
  EN_ITEM_FLOW_REASON_MAJOR_QUEST = 3;         // 任务/剧情
  EN_ITEM_FLOW_REASON_MAJOR_MALL = 4;         // 商城
}

enum EnItemFlowReasonMinorType {
  EN_ITEM_FLOW_REASON_MINOR_INVALID = 0;

  // User
  EN_ITEM_FLOW_REASON_MINOR_USER_INIT_ITEM = 1001;        // 创建角色初始道具
  EN_ITEM_FLOW_REASON_MINOR_USER_LEVEL_UP_REWARD = 1002;  // 升级奖励

  // GM command
  EN_ITEM_FLOW_REASON_MINOR_GM_ADD_ITEM = 2001;  // GM 加道具
  EN_ITEM_FLOW_REASON_MINOR_GM_SUB_ITEM = 2002;  // GM 减道具

  // Quest
  EN_ITEM_FLOW_REASON_MINOR_QUEST_REWARD = 3001;  // 任务奖励

  // Mall
  EN_ITEM_FLOW_REASON_MINOR_MALL_PURCHASE_COST = 12001;  // 商城购买消耗
  EN_ITEM_FLOW_REASON_MINOR_MALL_PURCHASE_REWARD = 12002;  // 商城购买奖励
}

message DItemBasic {
  int32 type_id = 1 [(org.xresloader.validator) = "ExcelItem_ADDABLE_item_id"];
  int64 count = 2;
  int64 guid = 3;  // 唯一ID(如果有)
}

// 道具数据实例
message DItemInstance {
  // 道具基础信息
  DItemBasic item_basic = 1;

  // 道具扩展数据,具体类型取决于道具类型
  google.protobuf.Any item_data = 5;

  int64 expire_timepoint = 11;  // 超时时间（如果有）
}

// 道具数据(增量,用于奖励等)
message DItemOffset {
  int32 type_id = 1 [(org.xresloader.validator) = "ExcelItem_ADDABLE_item_id"];
  int64 count = 2;

  // 有效期，0表示永久生效
  int64 expire_offset = 11 [(org.xresloader.field_allow_missing_in_plain_mode) = true];
}

// 道具数据(增量,限定Scope,用于奖励等)
message DItemScopeOffset {
  DItemOffset item_offset = 1 [(org.xresloader.validator) = "ExcelItem_ADDABLE_item_id"];
}

message DItemUseAction {
  oneof action_type {
    int64 add_role_exp = 1 [(org.xresloader.field_unique_tag) = "item"];
  }
}

message DItemAutoReward {
  // 奖励道具列表
  repeated DItemBasic reward_items = 1;

  oneof reason_type {
    uint32 user_level_up = 101;  // 用户升级
    int32 quest_id = 301;  // 任务id
  }
}

message DItemResetData {
  oneof reset_type {
    bool last_daily_reset_timepoint = 1 [(org.xresloader.field_alias) = "每日"];
    bool last_weekly_reset_timepoint = 2 [(org.xresloader.field_alias) = "每周"];
    bool last_monthly_reset_timepoint = 3 [(org.xresloader.field_alias) = "每月"];
  }
}