{{- define "libapp.httproute.tpl" -}}
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  # name: 使用 chart fullname 并追加 -http-route，允许通过 .Values.httproute.name 覆盖
  name: {{ default (printf "%s-http-route" (include "libapp.fullname" .)) }}
  namespace: {{ .Release.Namespace }}
  labels:
    app: {{ include "libapp.name" . }}
    release: {{ .Release.Name }}
spec:
  parentRefs:
  - name: {{ default (printf "%s-tls-gateway" (include "libapp.fullname" .)) }}
  # hostnames: 支持单个字符串或数组 .Values.httproute.hosts
  hostnames:
  {{- if .Values.httproute.hosts }}
  {{- range .Values.httproute.hosts }}
  - {{ . | quote }}
  {{- end }}
  {{- else }}
  - {{ default (printf "%s.example.com" (include "libapp.fullname" .)) .Values.httproute.host }}
  {{- end }}
  rules:

  
  - matches:
    - path:
        type: PathPrefix
        value: {{ default "/" .Values.httproute.path | quote }}
    backendRefs:
    - name: {{ default (include "libapp.fullname" .) }}
      port: {{ default 80 .Values.service.port }}
{{- end -}}
{{- define "libapp.httproute" -}}
{{- template "libapp.util.merge" (append . "libapp.httproute.tpl") -}}
{{- end -}}